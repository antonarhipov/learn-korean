/**
 * Lesson Template Library
 * Pre-structured templates for different types of Korean language lessons
 */

export const lessonTemplates = {
  // Basic pronunciation lesson template
  pronunciation: {
    id: "",
    title: "",
    level: "beginner",
    category: "pronunciation",
    description: "",
    prerequisites: [],
    nextLessons: [],
    estimatedTime: 15,
    content: {
      text: "In this lesson, you will learn about Korean pronunciation. We'll cover the sounds, practice with examples, and help you develop accurate pronunciation skills.\n\n[Add your main content here explaining the pronunciation concepts, rules, and techniques.]\n\n[Include cultural context or usage notes where relevant.]",
      examples: [
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        }
      ],
      media: {
        image: "",
        video: null
      }
    },
    exercises: [
      {
        type: "pronunciation",
        title: "Pronunciation Practice",
        audio: "",
        text: "",
        instructions: "Listen to the audio and repeat the sounds. Focus on accurate pronunciation."
      },
      {
        type: "quiz",
        title: "Sound Recognition Quiz",
        questions: [
          {
            question: "",
            options: ["", "", "", ""],
            correctAnswer: ""
          }
        ]
      }
    ]
  },

  // Grammar lesson template
  grammar: {
    id: "",
    title: "",
    level: "beginner",
    category: "grammar",
    description: "",
    prerequisites: [],
    nextLessons: [],
    estimatedTime: 20,
    content: {
      text: "This lesson introduces an important Korean grammar pattern. You'll learn how to use it correctly and see it in practical contexts.\n\n[Explain the grammar rule clearly with structure and usage patterns.]\n\n[Provide formation rules and any exceptions.]\n\n[Include when and how to use this grammar in conversation.]",
      examples: [
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        }
      ],
      media: {
        image: "",
        video: null
      }
    },
    exercises: [
      {
        type: "quiz",
        title: "Grammar Pattern Recognition",
        questions: [
          {
            question: "Choose the correct grammar pattern:",
            options: ["", "", "", ""],
            correctAnswer: ""
          },
          {
            question: "Which sentence uses the grammar correctly?",
            options: ["", "", "", ""],
            correctAnswer: ""
          }
        ]
      },
      {
        type: "flashcard",
        title: "Grammar Examples",
        cards: [
          {
            front: "",
            back: ""
          },
          {
            front: "",
            back: ""
          }
        ]
      }
    ]
  },

  // Vocabulary lesson template
  vocabulary: {
    id: "",
    title: "",
    level: "beginner",
    category: "vocabulary",
    description: "",
    prerequisites: [],
    nextLessons: [],
    estimatedTime: 18,
    content: {
      text: "In this vocabulary lesson, you'll learn essential Korean words related to [topic]. These words are commonly used in daily conversation and will help you communicate more effectively.\n\n[Introduce the vocabulary theme and its importance.]\n\n[Provide context for when these words are typically used.]\n\n[Include any cultural notes about usage.]",
      examples: [
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        }
      ],
      media: {
        image: "",
        video: null
      }
    },
    exercises: [
      {
        type: "flashcard",
        title: "Vocabulary Flashcards",
        cards: [
          {
            front: "",
            back: ""
          },
          {
            front: "",
            back: ""
          },
          {
            front: "",
            back: ""
          },
          {
            front: "",
            back: ""
          },
          {
            front: "",
            back: ""
          }
        ]
      },
      {
        type: "quiz",
        title: "Vocabulary Quiz",
        questions: [
          {
            question: "What does [Korean word] mean?",
            options: ["", "", "", ""],
            correctAnswer: ""
          },
          {
            question: "How do you say [English word] in Korean?",
            options: ["", "", "", ""],
            correctAnswer: ""
          }
        ]
      }
    ]
  },

  // Conversation lesson template
  conversation: {
    id: "",
    title: "",
    level: "intermediate",
    category: "conversation",
    description: "",
    prerequisites: [],
    nextLessons: [],
    estimatedTime: 25,
    content: {
      text: "This conversation lesson focuses on practical dialogue skills for [situation]. You'll learn common phrases, appropriate responses, and cultural etiquette for this context.\n\n[Describe the conversation context and setting.]\n\n[Explain key phrases and their usage.]\n\n[Include cultural tips for appropriate communication.]",
      examples: [
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        }
      ],
      media: {
        image: "",
        video: null
      }
    },
    exercises: [
      {
        type: "quiz",
        title: "Conversation Comprehension",
        questions: [
          {
            question: "What would you say in this situation: [scenario]?",
            options: ["", "", "", ""],
            correctAnswer: ""
          },
          {
            question: "Which response is most appropriate?",
            options: ["", "", "", ""],
            correctAnswer: ""
          }
        ]
      },
      {
        type: "pronunciation",
        title: "Dialogue Practice",
        audio: "",
        text: "",
        instructions: "Practice the dialogue with proper intonation and rhythm."
      }
    ]
  },

  // Culture lesson template
  culture: {
    id: "",
    title: "",
    level: "intermediate",
    category: "culture",
    description: "",
    prerequisites: [],
    nextLessons: [],
    estimatedTime: 22,
    content: {
      text: "This cultural lesson explores [cultural topic] in Korean society. Understanding this aspect of Korean culture will help you communicate more effectively and appropriately with Korean speakers.\n\n[Explain the cultural concept and its significance.]\n\n[Provide historical or social context.]\n\n[Describe how this affects language use and social interactions.]",
      examples: [
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        }
      ],
      media: {
        image: "",
        video: null
      }
    },
    exercises: [
      {
        type: "quiz",
        title: "Cultural Understanding Quiz",
        questions: [
          {
            question: "In Korean culture, when would you use this expression?",
            options: ["", "", "", ""],
            correctAnswer: ""
          },
          {
            question: "What is the appropriate behavior in this situation?",
            options: ["", "", "", ""],
            correctAnswer: ""
          }
        ]
      },
      {
        type: "flashcard",
        title: "Cultural Expressions",
        cards: [
          {
            front: "",
            back: ""
          },
          {
            front: "",
            back: ""
          }
        ]
      }
    ]
  },

  // Comprehensive lesson template (mixed content)
  comprehensive: {
    id: "",
    title: "",
    level: "intermediate",
    category: "grammar",
    description: "",
    prerequisites: [],
    nextLessons: [],
    estimatedTime: 30,
    content: {
      text: "This comprehensive lesson combines multiple aspects of Korean language learning. You'll practice grammar, vocabulary, pronunciation, and cultural understanding in an integrated approach.\n\n[Introduce the main theme connecting all elements.]\n\n[Explain how different language aspects work together.]\n\n[Provide comprehensive examples showing integration.]",
      examples: [
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        },
        {
          korean: "",
          romanization: "",
          translation: "",
          audio: ""
        }
      ],
      media: {
        image: "",
        video: null
      }
    },
    exercises: [
      {
        type: "quiz",
        title: "Comprehensive Quiz",
        questions: [
          {
            question: "",
            options: ["", "", "", ""],
            correctAnswer: ""
          },
          {
            question: "",
            options: ["", "", "", ""],
            correctAnswer: ""
          },
          {
            question: "",
            options: ["", "", "", ""],
            correctAnswer: ""
          }
        ]
      },
      {
        type: "flashcard",
        title: "Key Concepts Review",
        cards: [
          {
            front: "",
            back: ""
          },
          {
            front: "",
            back: ""
          },
          {
            front: "",
            back: ""
          }
        ]
      },
      {
        type: "pronunciation",
        title: "Integrated Practice",
        audio: "",
        text: "",
        instructions: "Practice the complete dialogue incorporating all lesson elements."
      }
    ]
  }
};

/**
 * Template metadata for UI display
 */
export const templateMetadata = {
  pronunciation: {
    name: "Pronunciation Lesson",
    description: "Focus on Korean sounds, phonetics, and pronunciation practice",
    icon: "ðŸ”Š",
    recommendedLevel: "beginner",
    estimatedTime: "15-20 minutes",
    features: ["Audio practice", "Sound recognition", "Pronunciation exercises"]
  },
  grammar: {
    name: "Grammar Lesson",
    description: "Teach Korean grammar patterns, rules, and structures",
    icon: "ðŸ“",
    recommendedLevel: "beginner-intermediate",
    estimatedTime: "20-25 minutes",
    features: ["Pattern recognition", "Rule explanation", "Usage examples"]
  },
  vocabulary: {
    name: "Vocabulary Lesson",
    description: "Introduce new Korean words and phrases with context",
    icon: "ðŸ“š",
    recommendedLevel: "all levels",
    estimatedTime: "15-20 minutes",
    features: ["Flashcards", "Word recognition", "Context usage"]
  },
  conversation: {
    name: "Conversation Lesson",
    description: "Practice real-world dialogue and communication skills",
    icon: "ðŸ’¬",
    recommendedLevel: "intermediate-advanced",
    estimatedTime: "25-30 minutes",
    features: ["Dialogue practice", "Situational context", "Cultural etiquette"]
  },
  culture: {
    name: "Culture Lesson",
    description: "Explore Korean culture, customs, and social contexts",
    icon: "ðŸ›ï¸",
    recommendedLevel: "intermediate",
    estimatedTime: "20-25 minutes",
    features: ["Cultural insights", "Social context", "Appropriate usage"]
  },
  comprehensive: {
    name: "Comprehensive Lesson",
    description: "Integrated lesson combining multiple language aspects",
    icon: "ðŸŽ¯",
    recommendedLevel: "intermediate-advanced",
    estimatedTime: "30-35 minutes",
    features: ["Multi-skill practice", "Integrated approach", "Complex scenarios"]
  }
};

/**
 * Get a template by type
 */
export function getTemplate(templateType) {
  if (!lessonTemplates[templateType]) {
    throw new Error(`Template type "${templateType}" not found`);
  }
  
  // Return a deep copy to avoid modifying the original template
  return JSON.parse(JSON.stringify(lessonTemplates[templateType]));
}

/**
 * Get all available template types
 */
export function getAvailableTemplates() {
  return Object.keys(lessonTemplates).map(type => ({
    type,
    ...templateMetadata[type]
  }));
}

/**
 * Create a new lesson from template with custom data
 */
export function createLessonFromTemplate(templateType, customData = {}) {
  const template = getTemplate(templateType);
  
  // Merge custom data with template
  const lesson = {
    ...template,
    ...customData,
    content: {
      ...template.content,
      ...(customData.content || {})
    }
  };
  
  // Generate unique ID if not provided
  if (!lesson.id) {
    lesson.id = `lesson-${Date.now()}`;
  }
  
  return lesson;
}

/**
 * Validate template structure
 */
export function validateTemplate(template) {
  const requiredFields = ['id', 'title', 'level', 'category', 'description', 'content', 'exercises'];
  const errors = [];
  
  for (const field of requiredFields) {
    if (!template[field]) {
      errors.push(`Missing required field: ${field}`);
    }
  }
  
  // Validate content structure
  if (template.content) {
    if (!template.content.text) {
      errors.push('Content must include text field');
    }
    if (!Array.isArray(template.content.examples)) {
      errors.push('Content must include examples array');
    }
  }
  
  // Validate exercises
  if (template.exercises) {
    if (!Array.isArray(template.exercises)) {
      errors.push('Exercises must be an array');
    } else if (template.exercises.length === 0) {
      errors.push('At least one exercise is required');
    }
  }
  
  return {
    isValid: errors.length === 0,
    errors
  };
}

/**
 * Get template suggestions based on lesson parameters
 */
export function getTemplateSuggestions(level, category, estimatedTime) {
  const suggestions = [];
  
  for (const [type, template] of Object.entries(lessonTemplates)) {
    const metadata = templateMetadata[type];
    let score = 0;
    
    // Score based on level match
    if (metadata.recommendedLevel.includes(level)) {
      score += 3;
    }
    
    // Score based on category match
    if (template.category === category) {
      score += 2;
    }
    
    // Score based on time estimate
    const templateTime = template.estimatedTime;
    const timeDiff = Math.abs(templateTime - estimatedTime);
    if (timeDiff <= 5) score += 2;
    else if (timeDiff <= 10) score += 1;
    
    if (score > 0) {
      suggestions.push({
        type,
        score,
        ...metadata
      });
    }
  }
  
  // Sort by score (highest first)
  return suggestions.sort((a, b) => b.score - a.score);
}

export default {
  lessonTemplates,
  templateMetadata,
  getTemplate,
  getAvailableTemplates,
  createLessonFromTemplate,
  validateTemplate,
  getTemplateSuggestions
};